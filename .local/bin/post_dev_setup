#!/usr/bin/env bash

export PATH="$HOME/.nix-profile/bin:/nix/var/nix/profiles/default/bin:$PATH"

echo "Installing Nix packages..."
nix-env -f $HOME/.config/nix/default.nix --install
echo "Install complete"

# Setup Github
if command -v gh &> /dev/null
then
	echo "Setting up GitHub..."
	read -p "Enter github config user.email: " email
	read -p "Enter github config user.name: " username
	if [ ! -z "$email" ] && [ ! -z "$username" ]
	then
		git config --global user.email "$email"
		git config --global user.name "$username"
	fi
	gh auth login
fi

echo "Setting up bare repo's submodules"
git --git-dir=$HOME/.dotfiles/ --work-tree=$HOME submodule update --init --remote

echo "Setting up packer / TPM"
git clone --depth 1 https://github.com/wbthomason/packer.nvim\
 ~/.local/share/nvim/site/pack/packer/start/packer.neovim
git clone https://github.com/tmux-plugins/tpm ~/.tmux/plugins/tpm
echo "Packer and TPM should be installed! Be sure to run :PackerSync and <prefix>+I to install each respectively"

# Setup Python3 for nvim and thefuck for zsh
if command -v python3 &> /dev/null
then
	echo "Insalling python deps..."
    pip3 install --user neovim
fi

read -p 'Set up zsh?(y/n) ' confirmZsh
if [[ $confirmZsh =~ ^[Yy]$ ]]; then
	command "$HOME/.local/bin/zsh_setup"
fi

echo "Local dev setup finished hopefully!"
