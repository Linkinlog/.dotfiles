#!/usr/bin/env bash

export PATH="$HOME/.nix-profile/bin:/nix/var/nix/profiles/default/bin:$PATH"
echo "Installing Nix packages..."
nix-env -f $HOME/.config/nix/default.nix --install
echo "Install complete"

# Setup Github
if command -v gh &> /dev/null
then
	echo "Setting up GitHub..."
	read -p "Enter github config user.email: " email
	read -p "Enter github config user.name: " username
	if [ ! -z "$email" ] && [ ! -z "$username" ]
	then
		git config --global user.email "$email"
		git config --global user.name "$username"
	fi
	gh auth login
fi

echo "Setting up bare repo"
#git clone --bare https://github.com/linkinlog/.dotfiles $HOME/.dotfiles
#git --git-dir=$HOME/.dotfiles/ --work-tree=$HOME checkout
git --git-dir=$HOME/.dotfiles/ --work-tree=$HOME submodule update --init --remote


# Setup Python3 for nvim and thefuck for zsh
if command -v python3 &> /dev/null
then
	echo "Insalling python deps..."
    python3 -m pip install neovim
fi

# Setup zsh from source
echo "Building zsh"
git clone https://github.com/zsh-users/zsh $HOME/zsh
.$HOME/zsh/Util/preconfig
.$HOME/zsh/configure
make -C $HOME/zsh
make -C $HOME/zsh check
make -C $HOME/zsh install

# Setup ohmyzsh
if command -v zsh &> /dev/null
then
	echo "Setting up OhMyZsh"
	export RUNZSH=no
	export KEEP_ZSHRC=yes
	sh -c "$(curl -fsSL https://raw.githubusercontent.com/ohmyzsh/ohmyzsh/master/tools/install.sh)"
	git clone https://github.com/zsh-users/zsh-syntax-highlighting.git ${ZSH_CUSTOM:-~/.oh-my-zsh/custom}/plugins/zsh-syntax-highlighting
	git clone https://github.com/zsh-users/zsh-autosuggestions ${ZSH_CUSTOM:-~/.oh-my-zsh/custom}/plugins/zsh-autosuggestions
	echo "OhMyZsh installed and configured, run zsh now"
fi

echo "Local dev setup finished hopefully!"
