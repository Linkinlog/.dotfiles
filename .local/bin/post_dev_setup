#!/usr/bin/env bash

export PATH="$HOME/.nix-profile/bin:/nix/var/nix/profiles/default/bin:$PATH"

echo "Installing Nix packages..."
nix-env -f $HOME/.config/nix/default.nix --install
export LD_LIBRARY_PATH="$HOME/.nix-profile/lib:$HOME/.nix-profile/lib64"
ncurses_path=$(nix-build '<nixpkgs>' -A ncurses.dev --no-out-link)
export LIBRARY_PATH="${ncurses_path}/lib:${LIBRARY_PATH}"
export CPPFLAGS="-I${ncurses_path}/include ${CPPFLAGS}"
export LDFLAGS="-L${ncurses_path}/lib ${LDFLAGS}"
echo "Install complete"

# Setup Github
if command -v gh &> /dev/null
then
	echo "Setting up GitHub..."
	read -p "Enter github config user.email: " email
	read -p "Enter github config user.name: " username
	if [ ! -z "$email" ] && [ ! -z "$username" ]
	then
		git config --global user.email "$email"
		git config --global user.name "$username"
	fi
	gh auth login
fi

echo "Setting up bare repo"
#git clone --bare https://github.com/linkinlog/.dotfiles $HOME/.dotfiles
#git --git-dir=$HOME/.dotfiles/ --work-tree=$HOME checkout
git --git-dir=$HOME/.dotfiles/ --work-tree=$HOME submodule update --init --remote


# Setup Python3 for nvim and thefuck for zsh
if command -v python3 &> /dev/null
then
	echo "Insalling python deps..."
    pip3 install --user neovim
fi

read -p 'Set up zsh?(y/n) ' confirmZsh
if [[ $confirmZsh =~ ^[Yy]$ ]]; then
	command "$HOME/.local/bin/zsh_setup"
fi

echo "Local dev setup finished hopefully!"
